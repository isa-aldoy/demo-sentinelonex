"""\nOpenRouter API Client - DEMO VERSION\nSimulates AI responses for fast demo without real API calls\n"""\nimport json\nimport time\nfrom typing import Dict, List, Optional\nimport random\n\nclass OpenRouterClient:\n    """Simulated OpenRouter client for demo purposes"""\n    \n    def __init__(self, api_key: Optional[str] = None):\n        self.api_key = api_key or "demo-key-no-real-api"\n        self.base_url = "https://openrouter.ai/api/v1"\n        \n    async def chat_completion(\n        self,\n        messages: List[Dict[str, str]],\n        model: str = "anthropic/claude-3.5-sonnet",\n        temperature: float = 0.7,\n        max_tokens: int = 4096\n    ) -> Dict:\n        """Simulated chat completion - returns realistic AI responses"""\n        \n        # Simulate API delay\n        await self._simulate_delay(1.5, 3.0)\n        \n        # Detect intent from user message\n        user_content = messages[-1]["content"].lower()\n        \n        if "analyze these mcp server test results" in user_content:\n            response = self._generate_analysis_response()\n        elif "generate a json remediation playbook" in user_content:\n            response = self._generate_remediation_response()\n        else:\n            response = "Analysis complete. The MCP server shows moderate security posture."\n        \n        return {\n            "choices": [{\n                "message": {\n                    "role": "assistant",\n                    "content": response\n                }\n            }],\n            "model": model,\n            "usage": {\n                "prompt_tokens": len(str(messages)) // 4,\n                "completion_tokens": len(response) // 4\n            }\n        }\n    \n    async def _simulate_delay(self, min_sec: float, max_sec: float):\n        """Simulate realistic API response time"""\n        import asyncio\n        delay = random.uniform(min_sec, max_sec)\n        await asyncio.sleep(delay)\n    \n    def _generate_analysis_response(self) -> str:\n        """Generate realistic vulnerability analysis"""\n        findings = random.choice([\n            "**Critical Findings**: CVE-2025-6514 detected - Remote code execution vulnerability in prompt handling.",\n            "**High Risk**: Server lacks proper authentication middleware for HTTP transport.",\n            "**Medium Risk**: Outdated dependencies detected with known CVE entries."\n        ])\n        \n        return f"""## MCP Security Analysis Report\n\n### Summary of Critical Findings\n{findings}\n\n### Risk Assessment: **HIGH**\n\n**Vulnerabilities Detected:**\n1. **CVE-2025-6514** (CVSS 9.6): Remote code execution via crafted prompts\n   - Exploitability: High - Public exploits available\n   - Impact: Complete system compromise possible\n\n2. **Authentication Bypass** (CVE-2025-49596): \n   - Missing JWT validation in HTTP transport layer\n   - Allows unauthorized tool execution\n\n3. **Injection Vulnerabilities**:\n   - SQL injection in database tool parameters\n   - Path traversal in file operations\n\n### Exploitability Analysis\nAn attacker with network access can:\n- Execute arbitrary code on the server\n- Access sensitive files via path traversal\n- Bypass authentication to invoke privileged tools\n\n### Impact on System Security\n**Critical**: This MCP server should be taken offline immediately until patches are applied.\nThe vulnerabilities allow complete system takeover with minimal effort.\n\n**Recommended Actions**: See remediation playbook for detailed steps.\n"""\n    \n    def _generate_remediation_response(self) -> str:\n        """Generate realistic remediation playbook"""\n        playbook = {\n            "immediate_actions": [\n                {\n                    "step": "Isolate MCP server from network",\n                    "priority": "critical",\n                    "command": "docker network disconnect bridge mcp-server-container"\n                },\n                {\n                    "step": "Disable vulnerable HTTP transport",\n                    "priority": "critical",\n                    "command": "sed -i 's/\"http\"/\"stdio\"/g' mcp-config.json"\n                },\n                {\n                    "step": "Apply security patches",\n                    "priority": "critical",\n                    "command": "pip install --upgrade mcp-server>=2.1.4"\n                }\n            ],\n            "short_term_fixes": [\n                "Implement JWT authentication for all HTTP endpoints",\n                "Add input validation middleware using jsonschema",\n                "Enable rate limiting (max 100 requests/minute per client)",\n                "Deploy Web Application Firewall (WAF) rules for known attack patterns"\n            ],\n            "long_term_improvements": [\n                "Migrate to stdio transport for production deployments",\n                "Implement automated CVE scanning in CI/CD pipeline",\n                "Set up security monitoring with alerts for suspicious tool calls",\n                "Conduct quarterly penetration testing",\n                "Enable Docker AppArmor/SELinux profiles"\n            ],\n            "monitoring_recommendations": [\n                "Monitor /var/log/mcp-server.log for injection attempts",\n                "Set up alerts for failed authentication attempts (>5 in 1 minute)",\n                "Track tool execution patterns for anomaly detection",\n                "Enable audit logging for all file system operations"\n            ]\n        }\n        \n        return f"```json\n{json.dumps(playbook, indent=2)}\n```"\n    \n    def available_models(self) -> List[str]:\n        """List of supported models (demo)"""\n        return [\n            "anthropic/claude-3.5-sonnet",\n            "openai/gpt-4-turbo", \n            "meta-llama/llama-3.1-70b-instruct"\n        ]\n